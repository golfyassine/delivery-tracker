<div class="tracking-container">

  <div class="header-section">
    <h1 class="app-title"><i class="fas fa-search-location"></i> Suivi de Livraison</h1>

    <div class="search-box">
      <input type="text"
             class="search-input"
             [(ngModel)]="idRecherche"
             (keyup.enter)="rechercher()"
             placeholder="Entrez votre nÂ° de suivi (ex: 1)"
             [disabled]="isLoading">
      <button (click)="rechercher()" 
              class="search-btn"
              [disabled]="isLoading">
        <span *ngIf="!isLoading"><i class="fas fa-search"></i> Suivre</span>
        <span *ngIf="isLoading"><i class="fas fa-spinner fa-spin"></i> Recherche...</span>
      </button>
    </div>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="error-message">
    <i class="fas fa-exclamation-circle"></i> {{ errorMessage }}
  </div>

  <!-- Ã‰tat de chargement -->
  <div *ngIf="isLoading && !livraison" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Recherche en cours...</p>
  </div>

  <div *ngIf="livraison && !isLoading" class="tracking-card">

    <div class="card-header">
      <div class="driver-info">
        <span>Votre livreur</span>
        <h2>{{ livraison.livreur }}</h2>
      </div>
      <div class="status-badge" [attr.data-status]="livraison.statutLivraison">
        <i class="fas" [ngClass]="getStatusIcon(livraison.statutLivraison)"></i>
        {{ livraison.statutLivraison }}
      </div>
    </div>

    <div class="stepper-container">
      <div class="stepper">
        <div class="progress-line">
          <div class="progress-line-fill" [style.width.%]="getProgressPercentage()"></div>
        </div>

        <div class="step active">
          <div class="step-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="step-label">ValidÃ©</div>
        </div>

        <div class="step" [ngClass]="{'active': livraison.statutLivraison === 'EN_ROUTE' || livraison.statutLivraison === 'LIVRE'}">
          <div class="step-icon">
            <i class="fas fa-truck"></i>
          </div>
          <div class="step-label">En route</div>
        </div>

        <div class="step" [ngClass]="{'active': livraison.statutLivraison === 'LIVRE'}">
          <div class="step-icon">
            <i class="fas fa-home"></i>
          </div>
          <div class="step-label">LivrÃ©</div>
        </div>
      </div>
    </div>

    <div class="map-wrapper">
      <div id="map"></div>
    </div>

    <div class="details-grid">
      <div class="detail-box">
        <span class="detail-label">ğŸ“ Destination</span>
        <div class="detail-value">
          {{ livraison.colisInfo?.adresseDestination || 'Adresse GPS' }}
        </div>
      </div>

      <div class="detail-box">
        <span class="detail-label"><i class="fas fa-box"></i> Colis NÂ°</span>
        <div class="detail-value">{{ livraison.colisInfo?.numeroSuivi || 'N/A' }}</div>
      </div>

      <div class="detail-box">
        <span class="detail-label"><i class="fas fa-clock"></i> Estimation</span>
        <div class="detail-value">
          {{ getEstimationText() }}
        </div>
      </div>
    </div>

    <div class="action-bar">
      <button class="btn-secondary">ğŸ“ Contacter</button>
      <button class="btn-primary">ğŸ“„ ReÃ§u</button>
    </div>

  </div>

  <div *ngIf="!livraison && !isLoading && !errorMessage" class="empty-state">
    <p><i class="fas fa-search"></i> Entrez un numÃ©ro de suivi ci-dessus pour localiser votre colis.</p>
  </div>

</div>
